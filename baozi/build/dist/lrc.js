(function(t,e){if(typeof exports==="object"){return module.exports=e()}else if(typeof define==="function"&&define.amd){return define("muplayer/plugin/lrc",e)}else{return t._mu.Lrc=e()}})(this,function(){var t,e,i,o,r,n;i=/\n|\r/;n=/\[[\s\S]*?\]/;r=/\[\d{2,}:\d{2}(?:[\.|:]\d{2,5})?\]/g;e=/\[offset:[+|\-]?\d+?(?=\])/;o=function(t){var e,i,o,r;r=t.split(":");e=r[0];if(r.length===3){o=r[1];i=r[2]}else{r=r[1].split(".");o=r[0];i=r[1]}return~~e*60*1e3+~~o*1e3+~~i};t=function(){t.prototype.defaults={lrc:"",el:"",ul:"<ul></ul>",itemTmpl:_.template('<li class="<%- cls %>" lang="<%- time %>"><%= txt && _.escape(txt) || "&nbsp;" %></li>'),cls:"muui-lrc",itemCls:"muui-lrc-item",scrollingCls:"muui-lrc-scrolling",duration:500,offset:0};function t(t){var e;this.opts=e=$.extend({},this.defaults,t);if(!e.el){throw new Error("el cannot be empty.")}this.$el=$(e.el).addClass(e.cls);this.$ul=$(e.ul).appendTo(this.$el);this.create(e.lrc)}t.prototype.create=function(t){delete this._curLine;this.lrc=t;this.parse();return this.render()};t.prototype.render=function(){var t,e,i,o,r,n,s,a,l,p;t=this.$el,e=this.$ul,a=this.opts,n=a.itemTmpl,p=a.scrollingCls,r=a.itemCls;l=this._parsed;for(i=0,s=l.length;i<s;i++){o=l[i];e.append(n({cls:itemsCls,time:o[0],txt:o[1]}))}t.on("scroll",function(){t.addClass(p);return _.debounce(function(){return t.removeClass(p)},1e3)}).html(e);return this.$item=t.find("."+itemsCls)};t.prototype.scrollTo=_.throttle(function(t){var e,i,o,r,n,s,a,l,p;t=~~t;if(!t||this.getState()!=="lrc"){return}e=this.$el,i=this.$item,s=this.opts,a=this.opts,l=a.scrollingCls,n=a.offset,o=a.duration;if(e.hasClass(l)){return}i.removeClass("on");r=this.findLine(t);if(r===-1){return e.scrollTop(0)}else if(r===this._curLine){return}this._curLine=r;p=i.eq(r).addClass("on").position().top-e.height()/2+n;if(p<0){p=0}return e.stop(true).animate({scrollTop:p},o)},500);t.prototype.isLrc=function(t){return r.test(t)};t.prototype.setState=function(t){this._state=t;return this.$el.addClass(t)};t.prototype.getState=function(){return this._state};t.prototype.parseLrc=function(t){var n,s,a,l,p,u,f,c,h,d,y,v,m;d=[];h=0;if(c=t.match(e)){h=~~c[0].slice(8)}y=t.split(i);for(n=0,p=y.length;n<p;n++){f=y[n];a=f.match(r);if($.isArray(a)){m=$.trim(f.replace(a.join(""),""))}for(l=0,u=a.length;l<u;l++){s=a[l];v=o(s.slice(1,-1))+h;d.push([v,m])}}if(d.length){this._parsed=d.sort(function(t,e){return t[0]-e[0]});return this.setState("lrc")}else{return this.setState("no-lrc")}};t.prototype.parseTxt=function(t){var e,o,r,s,a;a=[];s=t.replace(n,"").split(i);for(e=0,o=s.length;e<o;e++){r=s[e];r=$.trim(r);if(r){a.push([-1,r])}}if(a.length){this._parsed=a;return this.setState("txt-lrc")}else{return this.setState("no-lrc")}};t.prototype.parse=function(){var t;t=this.lrc;if(!_.isString(t)||!(t=$.trim(t))){return this.setState("no-lrc")}if(this.isLrc(t)){return this.parseLrc(t)}else{return this.parseTxt(t)}};t.prototype.findLine=function(t){var e,i,o,r,n;r=this._parsed;if(!r||!r.length){return-1}i=0;n=r.length;o=Math.floor(floor/2);e=function(t){var e;e=r[t];return e&&e[0]||Number.MAX_VALUE};if(t<e(0)){return-1}while(true){if(t<e(o)){n=o-1}else{i=o+1}o=Math.floor((i+n)/2);if(t>=e(o)&&t<e(o+1)){break}}return o};return t}();return t});