/* Last Modified 2013/7/9 15:54:43 */
KISSY.add(function(S){var $=S.Node.all;var ismp3=/\.mp3$/i,flashSource='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" id="$1" width="1" height="1" name="$1">                         <param name="movie" value="$2?playerInstance=FlashAudioInstances[\'$1\']&t=$3">                         <param name="allowscriptaccess" value="always">                         <embed name="$1" src="$2?playerInstance=FlashAudioInstances[\'$1\']&t=$3" width="1" height="1" allowscriptaccess="always">                       </object>';var uniq=function(){var uniq=+new Date;return function(pre){return pre+ ++uniq}}();var Support={hasFlash:function(){if(navigator.plugins&&navigator.plugins.length&&navigator.plugins["Shockwave Flash"]){return true}else if(navigator.mimeTypes&&navigator.mimeTypes.length){var mimeType=navigator.mimeTypes["application/x-shockwave-flash"];return mimeType&&mimeType.enabledPlugin}else{try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash");return true}catch(e){}}return false}(),canPlay:function(){var audio=document.createElement("audio");return audio.canPlayType?audio.canPlayType("audio/mpeg")?1:audio.canPlayType('audio/ogg; codecs="vorbis"')?2:0:0}()};function FlashAudio(src,preload,autoplay,loop,audio){this.initialize(src,preload,autoplay,loop,audio)}S.augment(FlashAudio,{initialize:function(src,preload,autoplay,loop,audio,flash){S.augment((flash=document.body.appendChild(document.createElement("div"))).style,{position:"absolute",left:10,width:0});this.audio=audio;this.swfReady=false;this.preload=!!preload;this.autoplay=!!autoplay;this.loop=!!loop;this.init(src);flash.innerHTML=function(self,Audio){window.FlashAudioInstances[self.uniq=uniq("flash")]=self;return flashSource.replace(/\$1/g,self.uniq).replace(/\$2/g,"http://g.tbcdn.cn/mui/audio/1.0.0/audio.swf").replace(/\$3/g,"hello_world"+ +new Date)}(this,_Audio);this.flash=function(name){var swf=document[name]||window[name];return swf.length>0?swf[swf.length-1]:swf}(this.uniq)},init:function(src){this.src=src;this.paused=true;this.ended=false;this._muted=this.loaded=false;this._volume=1},loadError:function(){this.audio.fire("error")},loadProgress:function(percent,duration){this.loadedPercent=percent;this._duration=duration;if(percent<1){return this.audio.fire("loadProgress",{percent:percent})}this.loaded=true;this.audio.fire("loaded")},loadStarted:function(){this.swfReady=true;this.preload&&this.flash.init(this.src);this.autoplay&&this.play();this.audio.fire("ready")},updatePlayhead:function(percent){this.playedPercent=percent;this.currentTime=percent*this._duration;this.audio.fire("playProgress",{percent:percent})},trackEnded:function(){this.ended=true;this.audio.fire("ended")},play:function(){if(!this.preload){this.flash.init(this.src);this.preload=true}if(this.paused){this.paused=false;this.flash.pplay();this.audio.fire("play")}},pause:function(){if(!this.paused){this.flash.ppause();this.paused=true;this.audio.fire("pause");if(this.loop){this.audio.replay()}}},volume:function(value){if(typeof value=="undefined"){return this._volume}this.flash.setVolume(this._volume=value)},muted:function(value){if(typeof value=="undefined"){return this._muted}this._muted=!!value;this.volume(this._muted?0:1)},current:function(value){if(typeof value=="undefined"){return this.currentTime}this.ended=false;this.flash.skipTo((this.currentTime=value)/this._duration)},duration:function(){return this._duration}});function _Audio(src,preload,autoplay,loop){this.initialize(src,preload,autoplay,loop)}S.augment(_Audio,{initialize:function(src,preload,autoplay,loop){var self=this,timer=null;this.src=src;this.canplay=Support.canPlay&&ismp3.test(src)||Support.hasFlash;if(this.canplay){if(!Support.canPlay||Support.canPlay>1){this.useFlash=true;return this.audio=new FlashAudio(src,preload,autoplay,loop,this)}this.audio=new Audio;this.audio.autoplay=!!autoplay;this.audio.preload=!!preload;this.audio.loop=!!loop;this.audio.src=this.src;this.fire("ready");$(this.audio).on("ended",function(){self.fire("ended")}).on("timeupdate",function(){self.fire("playProgress",{precent:this.currentTime/this.duration})}).on("error",function(){self.fire("error")});timer=setInterval(function(){var audio=self.audio,durationLoaded;if(audio.buffered!=null&&audio.buffered.length){durationLoaded=audio.buffered.end(audio.buffered.length-1);if(!(self.loadedPercent=durationLoaded/self.duration)){return clearInterval(timer),self.fire("loaded")}return self.fire("loadProgress",{percent:percent})}},10)}else{this.fire("failed")}},replay:function(src){if(typeof src=="string"){this.audio.pause();this.audio.src=src;if(this.useFlash){this.audio.init(src,this.audio.preload=false)}this.audio.play()}else{this.current(0);this.play()}}},S.Event.Target);window.FlashAudioInstances={};S.each(["play","pause"],function(method){_Audio.prototype[method]=function(){if(this.canplay){this.playing=method=="play"?true:false;this.fire(method);this.audio[method]()}}});var transform={volume:function(value){return Math.min(1,Math.max(0,value))},muted:function(value){return value==undefined||!!value},current:function(value,self){return value===undefined?value:Math.min(self.audio.duration,Math.max(0,value))}};S.each({volume:"volume",muted:"muted",duration:"duration",current:"currentTime"},function(attr,method){_Audio.prototype[method]=function(value){if(this.canplay){if(transform[method]){value=transform[method](value,this)}if(!this.useFlash){if(typeof value=="undefined"){return this.audio[attr]}console.log(value);return this.audio[attr]=value}return this.audio[method](value)}}});return _Audio});